imports:
    - { resource: parameters.yml }

services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

#######################################################################################
##                                       CRUD                                        ##
#######################################################################################

    beneficiary.household_service:
        class: BeneficiaryBundle\Utils\HouseholdService
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@beneficiary.beneficiary_service"
            - "@request_validator"
            - "@location_service"
        public: true

    BeneficiaryBundle\Utils\HouseholdService: '@beneficiary.household_service'

    beneficiary.institution_service:
        class: BeneficiaryBundle\Utils\InstitutionService
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@location_service"
        public: true

    beneficiary.community_service:
        class: BeneficiaryBundle\Utils\CommunityService
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@location_service"
            - "@CommonBundle\\Mapper\\LocationMapper"
        public: true

    beneficiary.repository:
        alias: BeneficiaryBundle\Repository\BeneficiaryRepository
        public: true

    BeneficiaryBundle\Repository\ProfileRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\Profile

    BeneficiaryBundle\Repository\NationalIdRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\NationalId

    BeneficiaryBundle\Repository\PhoneRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\Phone

    BeneficiaryBundle\Repository\VulnerabilityCriterionRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\VulnerabilityCriterion


    BeneficiaryBundle\Repository\HouseholdRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\Household
        calls:
          - injectLocationRepository: [ '@CommonBundle\Repository\LocationRepository' ]

    BeneficiaryBundle\Repository\BeneficiaryRepository:
        factory: ['@doctrine.orm.default_entity_manager', getRepository]
        arguments:
            - BeneficiaryBundle\Entity\Beneficiary
        calls:
            - injectLocationRepository: ['@CommonBundle\Repository\LocationRepository']

    BeneficiaryBundle\Repository\CountrySpecificRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\CountrySpecific

    BeneficiaryBundle\Repository\CommunityRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\Community

    BeneficiaryBundle\Repository\InstitutionRepository:
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - BeneficiaryBundle\Entity\Institution

    BeneficiaryBundle\Mapper\CommunityMapper:
        arguments:
            - '@BeneficiaryBundle\Mapper\AddressMapper'
            - '@BeneficiaryBundle\Mapper\NationalIdMapper'
            - '@CommonBundle\Mapper\LocationMapper'
            - '@BeneficiaryBundle\Mapper\PersonMapper'
            - '@ProjectBundle\Mapper\ProjectMapper'
        public: true

    BeneficiaryBundle\Mapper\InstitutionMapper:
        arguments:
            - '@BeneficiaryBundle\Mapper\AddressMapper'
            - '@BeneficiaryBundle\Mapper\NationalIdMapper'
            - '@BeneficiaryBundle\Mapper\PersonMapper'
            - '@ProjectBundle\Mapper\ProjectMapper'
        public: true

    BeneficiaryBundle\Mapper\AddressMapper:
        arguments:
            - '@CommonBundle\Mapper\LocationMapper'
        public: true

    BeneficiaryBundle\Mapper\NationalIdMapper:
        public: true

    BeneficiaryBundle\Mapper\BeneficiaryMapper:
        arguments:
            - "@serializer"
        public: true

    BeneficiaryBundle\Mapper\AssistanceMapper:
        arguments:
            - '@BeneficiaryBundle\Mapper\BeneficiaryMapper'
            - "@=service('doctrine.orm.entity_manager').getRepository('DistributionBundle:AssistanceBeneficiary')"
            - "@=service('doctrine.orm.entity_manager').getRepository('BeneficiaryBundle:Beneficiary')"
        public: true

    BeneficiaryBundle\Mapper\PhoneMapper:
        public: false

    BeneficiaryBundle\Mapper\PersonMapper:
        arguments:
            - '@BeneficiaryBundle\Mapper\PhoneMapper'
            - '@BeneficiaryBundle\Mapper\NationalIdMapper'
            - '@BeneficiaryBundle\Mapper\ProfileMapper'
        public: false

    BeneficiaryBundle\Mapper\ProfileMapper:
        public: false

    beneficiary.beneficiary_service:
        class: BeneficiaryBundle\Utils\BeneficiaryService
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@request_validator"
            - "@validator"
            - '@CommonBundle\Utils\ExportService'
            - '@BeneficiaryBundle\Repository\BeneficiaryRepository'
            - '@BeneficiaryBundle\Repository\HouseholdRepository'
            - '@BeneficiaryBundle\Repository\VulnerabilityCriterionRepository'
            - '@BeneficiaryBundle\Repository\PhoneRepository'
            - '@BeneficiaryBundle\Repository\NationalIdRepository'
            - '@BeneficiaryBundle\Repository\ProfileRepository'
        public: true

    BeneficiaryBundle\Utils\BeneficiaryService:
        alias: beneficiary.beneficiary_service

    beneficiary.country_specific_service:
        class: BeneficiaryBundle\Utils\CountrySpecificService
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@service_container"
        public: true

    beneficiary.vulnerability_resolver:
        class: BeneficiaryBundle\Model\Vulnerability\Resolver
        arguments:
            - "%vulnerability_weightingFile%"
            - "%vulnerability_scoringFileTemplate%"
            - "@beneficiary.repository"
        public: true

#######################################################################################
##                                        CSV                                        ##
#######################################################################################

    BeneficiaryBundle\Utils\HouseholdExportCSVService:
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@export_csv_service"

    beneficiary.household_export_csv_service:
        alias: BeneficiaryBundle\Utils\HouseholdExportCSVService
        public: true

    beneficiary.csv_to_array_mapper:
        class: BeneficiaryBundle\Utils\Mapper\CSVToArrayMapper
        arguments:
            - "@doctrine.orm.entity_manager"
        public: true

    household.activity_listerer:
        class: BeneficiaryBundle\Listener\HouseholdActivitySubscriber
        autowire: true
        tags:
            - { name: 'doctrine.event_subscriber', priority: 500 }
