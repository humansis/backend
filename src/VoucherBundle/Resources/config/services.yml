services:

    VoucherBundle\Controller\:
        resource: '../../Controller'
        public: true
        autowire: true
        tags: [ 'app.controller' ]

    VoucherBundle\Repository\VendorRepository:
        class: Doctrine\ORM\EntityRepository
        calls:
            - setLocationRepository: ['@CommonBundle\Repository\LocationRepository']
        factory: [ '@doctrine.orm.default_entity_manager', getRepository ]
        arguments:
            - VoucherBundle\Entity\Vendor

#######################################################################################
##                                       CRUD                                        ##
#######################################################################################

    smartcard_purchase.repository:
        class: VoucherBundle\Repository\SmartcardPurchaseRepository
        factory: ['@doctrine.orm.default_entity_manager', getRepository]
        arguments:
            - VoucherBundle\Entity\SmartcardPurchase

    VoucherBundle\Repository\SmartcardPurchaseRepository:
        alias: smartcard_purchase.repository

    voucher.vendor_service:
        class: VoucherBundle\Utils\VendorService
        arguments: ['@doctrine.orm.entity_manager', '@validator', '@location_service', '@service_container']
        public: true

    VoucherBundle\Utils\VendorService: '@voucher.vendor_service'

    voucher.booklet_service:
        class: VoucherBundle\Utils\BookletService
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@validator'
            - '@service_container'
            - '@VoucherBundle\Utils\BookletGenerator'
        public: true

    voucher.voucher_service:
        class: VoucherBundle\Utils\VoucherService
        arguments: ['@doctrine.orm.entity_manager', '@validator', '@service_container']
        public: true

    voucher.product_service:
        class: VoucherBundle\Utils\ProductService
        arguments: ['@doctrine.orm.entity_manager', '@validator', '@service_container']
        public: true

    common.upload_service:
        class: CommonBundle\Utils\UploadService
        arguments: ['%aws_access_key_id%', '%aws_secret_access_key%', '%aws_s3_region%', '@service_container' ]
        public: true

    voucher.purchase_service:
        class: VoucherBundle\Model\PurchaseService
        public: true
        arguments: [ '@doctrine.orm.entity_manager', '@logger' ]

    smartcard_service:
        class: VoucherBundle\Utils\SmartcardService
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@voucher.purchase_service'
            - '@workflow.registry'
            - '@logger'
            - '@cache.app'
            - '@=service("doctrine.orm.entity_manager").getRepository("DistributionBundle:AssistanceBeneficiary")'
            - '@=service("doctrine.orm.entity_manager").getRepository("NewApiBundle:Assistance\\ReliefPackage")'
        public: true

    VoucherBundle\Mapper\SmartcardMapper:
        public: true

    VoucherBundle\Mapper\BookletMapper:
        arguments:
            - "@serializer"
        public: true

    VoucherBundle\Mapper\VoucherRedemptionBatchMapper:
        tags: [ 'app.mapper' ]

    VoucherBundle\Utils\BookletGenerator:
        public: true
        arguments: [ '@doctrine.orm.entity_manager' ]
