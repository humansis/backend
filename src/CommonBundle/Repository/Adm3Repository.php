<?php

namespace CommonBundle\Repository;

use CommonBundle\Entity\Adm2;
use CommonBundle\Entity\Adm3;
use Doctrine\ORM\Query\Expr\Join;

/**
 * Adm3Repository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class Adm3Repository extends AdmBaseRepository
{
    public function findByAdm2(Adm2 $adm1): array
    {
        return $this->findBy(['adm2' => $adm1], ['name' => 'ASC']);
    }

    /**
     * @param Adm2   $adm2
     * @param string $code
     *
     * @return Adm3|null
     * @throws \Doctrine\ORM\NonUniqueResultException
     */
    public function findByAdm2AndCode(Adm2 $adm2, string $code): ?Adm3
    {
        return $this->createQueryBuilder('adm3')
            ->leftJoin('adm3.adm2', 'adm2', Join::WITH, 'adm2.id = :adm2')
            ->where('adm3.code = :code')
            ->setParameter('adm2', $adm2->getId())
            ->setParameter('code', $code)
            ->getQuery()
            ->getOneOrNullResult();
    }
}
